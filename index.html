<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>IPTV Venezuela - AutoSave</title>
    <link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet" />
    <script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>
    <style>
        body { margin: 0; background: #000; color: white; font-family: sans-serif; display: flex; height: 100vh; overflow: hidden; }
        .sidebar { width: 300px; background: #111; border-right: 1px solid #333; display: flex; flex-direction: column; }
        .sidebar-header { padding: 15px; border-bottom: 1px solid #333; background: #1a1a1a; }
        #channel-list { flex-grow: 1; overflow-y: auto; padding: 10px; }
        .section-title { font-size: 11px; color: #fb542b; padding: 10px 5px; text-transform: uppercase; font-weight: bold; }
        .channel-btn { width: 100%; padding: 10px; background: #222; border: none; color: white; text-align: left; margin-bottom: 4px; cursor: pointer; border-radius: 4px; font-size: 12px; }
        .channel-btn:hover { background: #fb542b; }
        .main { flex-grow: 1; display: flex; flex-direction: column; }
        .video-js { width: 100% !important; height: 100% !important; }
        .file-label { background: #fb542b; padding: 10px; display: block; text-align: center; cursor: pointer; border-radius: 5px; font-weight: bold; }
        #file-input { display: none; }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="sidebar-header">
        <label for="file-input" class="file-label">ðŸ“‚ CARGAR LISTA .M3U</label>
        <input type="file" id="file-input" accept=".m3u,.txt">
    </div>
    <div id="channel-list">
        <div class="section-title">Canales de Emergencia</div>
        <button class="channel-btn" onclick="play('https://telesur.akamaized.net/hls/main.m3u8')">ðŸ“º TeleSUR</button>
        <div id="user-section" style="display:none;">
            <div class="section-title">Mi Lista Guardada</div>
            <div id="user-channels"></div>
        </div>
    </div>
</div>

<div class="main">
    <video id="my-video" class="video-js vjs-big-play-centered" controls preload="auto"></video>
</div>

<script>
    var player = videojs('my-video');

    // Al abrir la App, revisamos si hay una lista guardada
    window.onload = function() {
        const savedList = localStorage.getItem('iptv_list');
        if (savedList) {
            parseM3U(savedList);
        }
    };

    function play(url) {
        player.src({ src: url, type: 'application/x-mpegURL' });
        player.play();
    }

    document.getElementById('file-input').addEventListener('change', function(e) {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = function(event) {
            const content = event.target.result;
            localStorage.setItem('iptv_list', content); // GUARDAR EN MEMORIA
            parseM3U(content);
        };
        reader.readAsText(file);
    });

    function parseM3U(content) {
        const container = document.getElementById('user-channels');
        document.getElementById('user-section').style.display = 'block';
        container.innerHTML = '';
        const lines = content.split('\n');
        let name = '';
        lines.forEach(line => {
            line = line.trim();
            if (line.startsWith('#EXTINF:')) {
                name = line.split(',').pop();
            } else if (line.startsWith('http')) {
                const btn = document.createElement('button');
                btn.className = 'channel-btn';
                btn.textContent = 'ðŸ”¹ ' + (name || 'Canal');
                const url = line;
                btn.onclick = () => play(url);
                container.appendChild(btn);
                name = '';
            }
        });
    }
</script>
</body>
</html>
